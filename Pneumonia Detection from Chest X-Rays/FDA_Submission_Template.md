# FDA  Submission

**Your Name:** Wafa Alshaiddi

**Name of your Device:** PneumoRay

## Algorithm Description 

### 1. General Information

**Intended Use Statement:** 
    Identify Pneumonia

**Indications for Use:**
Screening chest x-ray of men and women between the age of 10-90 to help doctors detect pneumonia.

**Device Limitations:**
1) The diagnosis doesn't take in consideration the patient's medical history. 
2) The diagnosis doesn't include lateral view X-Ray. 
3) The model may be slow without GPU.


**Clinical Impact of Performance: ** 

It is a screening model for pneumonia not a confirmatory method, so high recall value is more important than precision value which mean it has low false negative. It is more clinically dangerous to diagnose a Pneumonia-positive patient as negative than Pneumonia-negative patient as positive since false positive results will usually undergo further testing while false negative results will be neglected. 

### 2. Algorithm Design and Function

<< Insert Algorithm Flowchart >>

![Algorithm Flowchart](flowchart.png)

**DICOM Checking Steps:**
To filter the valid from invalid DICOM images, I checked the following attributes of each image: 
1) The body part examined = Chest
2) The modality = DX
3) The body position = PA or AP

**Preprocessing Steps:**
I set the size of images to (224,224), then divided it by 225 to have a mean of 0 and standard deviation of 1 

**CNN Architecture:**
The CNN Architecture used is VGG16, I added three dense layers and one additional dense layer with the function "sigmoid" to make the output of the last layer in the range of (0,1). I also added 3 dropout layers to prevent the model from overfitting.

![Layers](layers.png)

![CNN Architecture](CNN architecture.png)


### 3. Algorithm Training

**Parameters:**
* Types of augmentation used during training
    rescale=1. / 255.0
    horizontal_flip = True
    vertical_flip = False
    height_shift_range= 0.1
    width_shift_range=0.1
    rotation_range=20
    shear_range = 0.1
    zoom_range=0.1
* Batch size
    120
* Optimizer learning rate
    Adam(lr=1e-4)
* Layers of pre-existing architecture that were frozen
    Non-trainable params: 12,354,880
* Layers of pre-existing architecture that were fine-tuned
    Trainable params: 28,707,329
* Layers added to pre-existing architecture
    my_model.add(Flatten())
    my_model.add(Dropout(0.5))
    my_model.add(Dense(1024, activation='relu'))
    my_model.add(Dropout(0.5))
    my_model.add(Dense(512, activation='relu'))
    my_model.add(Dropout(0.5))
    my_model.add(Dense(256, activation='relu'))
    my_model.add(Dense(1, activation='sigmoid'))


<< Insert algorithm training performance visualization >> 
![Training loss and Accuracy](Training loss and Accuracy on Dataset.png)
              
<< Insert P-R curve >>
![Precision-Recall Curve](Precision : Recall.png)

![Accuracy Curve](T:F Positive rate.png)


**Final Threshold and Explanation:**

![F1 Score - Thershold Curve](F1 Score : Thershold.png)

The optimum thresholds generated by this model is 0.43 were the F1 score is 0.48 , the recall is 0.8 and the accuracy is 0.57. The precision was 0.34
which considered low, but since it is a screening model a high recall value is more important.

### 4. Databases
 (For the below, include visualizations as they are useful and relevant)

**Description of Training Dataset:** 
The training dataset has 2290 cases divided into two classes:
50% Pneumonia(1145) & 50% No Pneumonia (1145)

![Training Dataset](Training Dataset.png)
 
**Description of Validation Dataset:** 
The validation dataset has 1430 cases divided into two classes:
20% Pneumonia(286) & 80% No Pneumonia(1144)

![Validation Dataset](Validation Dataset.png)


### 5. Ground Truth

The gold standard method is to send a biopsy to the lab; however, it is an expensive method that takes a long time. A faster and cheaper method is used as a ground truth to validate this model. It is the Natural Language Processing (NLP) which extract diagnosis from associated radiological reports. however it is considered less accurate than the gold standard method.

### 6. FDA Validation Plan

**Patient Population Description for FDA Validation Dataset:**

Digital X-ray images of the chest area in the PA or AP position of male or female patients between the age of 10-90 with a prevalence of pneumonia that reflect the prevalence of pneumonia in the general population.

**Ground Truth Acquisition Methodology:**

The ground truth that will be used to evaluate the model is the silver standard where several radiologists will be asked to give their diagnosis of each X-ray image and based on their experiences a scoring system will be designed so that the higher their experiences the higher their diagnosis valued , then the score will be calculated for each image to give the final diagnosis which will be our ground truth method. 

**Algorithm Performance Standard:**

The algorithm performance standard will be obtained from literature by compairing the F1 Score of the model to the F1 of multiple studies.

![Example of Performance Standard](Example of Performance Standard .png)  (Rajpurkar et al., 2022)

Reference:
*Rajpurkar, P., Irvin, J., Zhu, K., Yang, B., Mehta, H., & Duan, T. et al. (2022). CheXNet: Radiologist-Level Pneumonia Detection on Chest X-Rays with Deep Learning. Retrieved 13 May 2022, from https://arxiv.org/abs/1711.05225*
